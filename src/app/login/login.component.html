<ion-content id="login-page">
  <div class="wave-container">
    <svg viewBox="0 0 1440 320" preserveAspectRatio="none">
      <path fill="#973661" fill-opacity="1"
        d="M0,224L48,229.3C96,235,192,245,288,234.7C384,224,480,192,576,192C672,192,768,224,864,213.3C960,203,1056,149,1152,149.3C1248,149,1344,203,1392,229.3L1440,256L1440,0L1392,0C1344,0,1248,0,1152,0C1056,0,960,0,864,0C768,0,672,0,576,0C480,0,384,0,288,0C192,0,96,0,48,0L0,0Z">
      </path>
    </svg>
  </div>

  <div class="login-content ion-padding ion-text-center">
    <!-- PASO 1: Login con email y contrase帽a -->
    <div *ngIf="!showVerificationStep">
      <div class="logo-container">
        <ion-icon name="lock-closed-outline" size="large"></ion-icon>
        <ion-text class="momo-signature-regular" style="color: #973661;">
          <h1>Iniciar Sesi贸n</h1>
        </ion-text>
      </div>

      <ion-list lines="none" class="minimal-list">
        <ion-item>
          <ion-input 
            label="Correo electr贸nico" 
            label-placement="floating" 
            type="email"
            [(ngModel)]="email"
            placeholder="ejemplo@dominio.com">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-input 
            label="Contrase帽a" 
            label-placement="floating" 
            type="password"
            [(ngModel)]="password"
            placeholder="Tu contrase帽a">
          </ion-input>
        </ion-item>
      </ion-list>

      <ion-button 
        expand="block" 
        class="ion-margin-top" 
        style="--background: #973661; --background-activated: #c15485;"
        (click)="login()"
        [disabled]="isLoading">
        <ion-icon *ngIf="isLoading" name="hourglass-outline" slot="start"></ion-icon>
        {{ isLoading ? 'Enviando c贸digo...' : 'Continuar' }}
      </ion-button>
    </div>

    <!-- PASO 2: Verificaci贸n de c贸digo 2FA -->
    <div *ngIf="showVerificationStep">
      <div class="logo-container">
        <ion-icon name="mail-outline" size="large" style="color: #973661;"></ion-icon>
        <ion-text class="momo-signature-regular" style="color: #973661;">
          <h1>Verificaci贸n</h1>
        </ion-text>
        <ion-text color="medium">
          <p>Ingresa el c贸digo de 6 d铆gitos que enviamos a tu correo</p>
        </ion-text>
      </div>

      <ion-list lines="none" class="minimal-list">
        <ion-item>
          <ion-input 
            label="C贸digo de verificaci贸n" 
            label-placement="floating" 
            type="text"
            inputmode="numeric"
            maxlength="6"
            [(ngModel)]="verificationCode"
            placeholder="123456">
          </ion-input>
        </ion-item>
      </ion-list>

      <ion-button 
        expand="block" 
        class="ion-margin-top" 
        style="--background: #973661; --background-activated: #c15485;"
        (click)="verifyCode()"
        [disabled]="isLoading">
        <ion-icon *ngIf="isLoading" name="hourglass-outline" slot="start"></ion-icon>
        {{ isLoading ? 'Verificando...' : 'Verificar c贸digo' }}
      </ion-button>

      <ion-button 
        expand="block" 
        fill="clear"
        color="medium"
        (click)="backToLogin()"
        [disabled]="isLoading">
        <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
        Volver
      </ion-button>
    </div>

    <!-- Bot贸n de login biom茅trico -->
    <ion-button
      *ngIf="biometricAvailable && hasBiometricCredentials"
      expand="block"
      fill="outline"
      class="ion-margin-top biometric-button"
      (click)="loginWithBiometric()"
      [disabled]="isLoading"
    >
      <ion-icon name="finger-print" slot="start"></ion-icon>
      Usar Face ID / Huella
    </ion-button>

    <!-- Mensaje si biometr铆a est谩 disponible pero no registrada -->
    <div *ngIf="biometricAvailable && !hasBiometricCredentials" class="ion-text-center ion-margin-top">
      <ion-text color="medium">
        <p style="font-size: 0.9em;">
           Despu茅s de iniciar sesi贸n podr谩s habilitar Face ID / Huella digital
        </p>
      </ion-text>
    </div>

    <ion-button
      expand="block"
      class="ion-margin-top outline-button"
      routerLink="/register"
    >
      Reg铆strate
    </ion-button>

    <!-- Opci贸n para desactivar biometr铆a (solo visible si est谩 activada) -->
    <ion-button
      *ngIf="hasBiometricCredentials"
      expand="block"
      fill="clear"
      size="small"
      color="medium"
      class="ion-margin-top"
      (click)="removeBiometric()"
    >
      <ion-icon name="trash-outline" slot="start"></ion-icon>
      Desactivar biometr铆a
    </ion-button>
  </div>
</ion-content>
